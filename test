import numpy as np 
import pandas as pd 
import warnings
import matplotlib
import matplotlib.pyplot as plt
warnings.filterwarnings('ignore')
from bokeh.plotting import figure, show, output_file, output_notebook
from bokeh.palettes import Spectral11, colorblind, Inferno, BuGn, brewer
from bokeh.models import HoverTool, value, LabelSet, Legend, ColumnDataSource,LinearColorMapper,BasicTicker, PrintfTickFormatter, ColorBar
import datetime
from bokeh.io import show
from bokeh.models import CustomJS, Dropdown
import os


data = pd.read_csv('taxthing4.csv', parse_dates=['Date'])
data.head()
data.Date.min(), data.Date.max()
data.incomesize2.value_counts()
data['Year'] = data.Date.apply(lambda x: x.year)

data.head()
wide = data.pivot_table(index='Date', columns='incomesize2', values=('AnnutitesTaxableTotal','1040DTaxableNetLossTotal'))
wide.reset_index(inplace=True)
wide['Year'] = wide.Date.apply(lambda x: x.year)

temp_df = wide.groupby(['Year']).sum().reset_index()
temp_df.head()
cats = ['0 to 50k','50k to 200k','200k to 1mil','1mil and up'] 
print(temp_df)
temp_df.head()
TOOLS = "save,pan,box_zoom,reset,wheel_zoom,tap"


source = ColumnDataSource(data=temp_df)
p = figure( plot_width=800, title="AnnutitesTaxableTotal",toolbar_location='above', tools=TOOLS)
colors = brewer['Dark2'][4]
p.vbar_stack(cats, x='Year', width=0.9, color=colors, source=source,
             legend=[value(x) for x in cats])

p.y_range.start = 0
p.x_range.range_padding = 0.1
p.xgrid.grid_line_color = None
p.axis.minor_tick_line_color = None
p.outline_line_color = None
p.yaxis.formatter.use_scientific = False
matplotlib.ticker.FuncFormatter(lambda x, p: format(int(x), ','))
p.xaxis.axis_label = 'Year'
p.yaxis.axis_label = 'USD'
p.legend.location = "top_left"
p.legend.orientation = "horizontal"

##output_file("AnnutitesTaxableTotal.html", title="Stacked Bar Chart")

show(p)
